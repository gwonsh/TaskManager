{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Config"
    },
    "name": "MyController",
    "designerId": "4e2c9f56-d360-4251-ad0d-8e88ef9c39d7",
    "cn": [
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "userShortcuts"
                ],
                "fn": "setShortcuts",
                "implHandler": [
                    "var me = this;",
                    "",
                    "var scWin = Ext.create(Ext.window.Window, {",
                    "    itemId:'shortcutsWin',",
                    "    width:810,",
                    "    height:650,",
                    "    bodyStyle:'padding:20px',",
                    "    modal:true,",
                    "    title:locale.config.config,",
                    "    layout: {",
                    "        type: 'hbox',",
                    "        align: 'top'",
                    "    },",
                    "    tools: [",
                    "        {",
                    "            xtype: 'tool',",
                    "            type: 'help',",
                    "            listeners: {",
                    "                click: function(){",
                    "                    /* show help window */",
                    "                    var usage = '<div style=\"margin:0 auto\">';",
                    "                    usage    += \t'<div style=\"font-size:16px;width:100%;margin-bottom:15px\">바로가기추가</div>';",
                    "                    usage    +=\t\t'<img src=\"resources/images/usage/usage_newshortcut.jpg\" style=\"border:1px solid #cecece\">';",
                    "                    usage    += \t'<div style=\"height:30px\"></div>';",
                    "                    usage    += \t'<div style=\"font-size:16px;width:100%;margin-bottom:15px\">바로가기수정</div>';",
                    "                    usage    +=\t\t'<img src=\"resources/images/usage/btn_editshortcut.jpg\" style=\"border:1px solid #cecece\">';",
                    "                    usage    += \t'<div style=\"height:30px\"></div>';",
                    "                    usage    += \t'<div style=\"font-size:16px;width:100%;margin-bottom:15px\">바로가기 아이콘선택</div>';",
                    "                    usage    +=\t\t'<img src=\"resources/images/usage/usage_selecticon.jpg\" style=\"border:1px solid #cecece\">';",
                    "                    usage    += \t'<div style=\"height:30px\"></div>';",
                    "                    usage    += \t'<div style=\"font-size:16px;width:100%;margin-bottom:15px\">바로가기 삭제</div>';",
                    "                    usage    +=\t\t'<img src=\"resources/images/usage/btn_delete.jpg\" style=\"border:1px solid #cecece\">';",
                    "                    usage    += \t'<div style=\"height:30px\"></div>';",
                    "                    usage    += \t'<div style=\"font-size:16px;width:100%;margin-bottom:15px\">바로가기 삭제</div>';",
                    "                    usage    +=\t\t'<img src=\"resources/images/usage/btn_edittitle.jpg\" style=\"border:1px solid #cecece\">';",
                    "                    usage    += '</div>';",
                    "                    var win = Ext.create('Ext.window.Window', {",
                    "                        bodyStyle:'padding:20px',",
                    "                        modal:true,",
                    "                        layout:{",
                    "                            type:'vbox',",
                    "                            align:'center'",
                    "                        },",
                    "                        items:[",
                    "                            {",
                    "                                xtype:'container',",
                    "                                width:820,",
                    "                                maxHeight:800,",
                    "                                minHeight:800,",
                    "                                scrollable:true,",
                    "                                html:usage",
                    "                            }",
                    "                        ]",
                    "                    }).show();",
                    "                }",
                    "            }",
                    "        }",
                    "    ],",
                    "    onEsc:function(){",
                    "        /* to prevent esc event */",
                    "    },",
                    "    items:[",
                    "        {",
                    "            xtype: 'treepanel',",
                    "            itemId: 'categoryTree',",
                    "            width:330,",
                    "            height:'100%',",
                    "            header:false,",
                    "            hideHeaders: true,",
                    "            store:Ext.getStore('CategoryStore'),",
                    "            columns: [",
                    "                {",
                    "                    xtype: 'treecolumn',",
                    "                    flex:1,",
                    "                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {",
                    "                        var val = '';",
                    "                        /* if item is not shortcut */",
                    "                        if(!record.get('isShortcut')){",
                    "                            val =  '<span>' + record.get('text') + ' </span><img src=\"resources/images/ico_plus_vs.png\" style=\"margin-left:10px\" action=\"add\">';",
                    "                        }",
                    "                        /* if item is already shortcut */",
                    "                        else{",
                    "                            val =  '<span>' + record.get('text') + ' </span><img src=\"resources/images/ico_minus_vs.png\" style=\"margin-left:10px\" action=\"del\">';",
                    "                            localStorage.setItem('shortcut_' + record.get('id'), false);",
                    "                        }",
                    "                        if(record.get('id') == 'root'){",
                    "                            val = '';",
                    "                        }",
                    "                        return val;",
                    "                    },",
                    "                    text: 'MyTreeColumn'",
                    "                }",
                    "            ],",
                    "            listeners: [",
                    "                {",
                    "                    afterrender: function(component){",
                    "                        var selectedCon = scWin.down('#selectedCon');",
                    "                        /* show current user shotcut set */",
                    "                        if(userShortcuts.length !== 0){",
                    "                            Ext.Array.each(userShortcuts, function(entry){",
                    "                                me.createShortcut(scWin, entry);",
                    "                            });",
                    "                        }",
                    "                        else{",
                    "                            /* add tip for setting at first time */",
                    "                            selectedCon.add({",
                    "                                xtype:'label',",
                    "                                itemId:'notice',",
                    "                                html:'<div style=\"text-align:center;margin-top:200px;color:#777777;font-size:14px\">카테고리의 <img src=\"resources/images/ico_plus_vs.png\"> 아이콘을 클릭해서 바로가기를 추가하</div>'",
                    "                            });",
                    "",
                    "                        }",
                    "                        /* check if shortcut of category already exists in current shortcut list */",
                    "                        var cStore = component.getStore();",
                    "                        cStore.on('load', function(){",
                    "                            cStore.each(function(record){",
                    "                                var scId = 'shortcut_' + record.get('id');",
                    "                                if(selectedCon.getComponent(scId) !== undefined){",
                    "                                    record.set('isShortcut', true);",
                    "                                }",
                    "                            });",
                    "                        });",
                    "                    }",
                    "                },",
                    "                {",
                    "                    /* when click category tree */",
                    "                    itemClick:function(view, record, item, index, event){",
                    "                        var action = event.target.getAttribute('action');",
                    "                        /* when click add to shortcut */",
                    "                        var shortcutCon = scWin.down('#selectedCon');",
                    "                        if(record.get('isShortcut')){",
                    "                            /* if it is alreay add to container remove it from shortcut list */",
                    "                            record.set('isShortcut', false);",
                    "                            if(shortcutCon.down('#shortcut_' + record.get('id')) !== null){",
                    "                                shortcutCon.down('#shortcut_' + record.get('id')).destroy();",
                    "                            }",
                    "                        }",
                    "                        else{",
                    "                            var gridType = '';",
                    "                            if(record.get('data').layout == 0 ||  record.get('data').layout == 2){",
                    "                                gridType = 'normal';",
                    "                            }",
                    "                            else{",
                    "                                gridType = 'gallery';",
                    "                            }",
                    "                            var scInfo = {",
                    "                                piSrc:'resources/shortcuts/pi_default.png',",
                    "                                ca_id:record.get('id'),",
                    "                                ca_name:record.get('title'),",
                    "                                /* define display type for dataview */",
                    "                                displayType:gridType",
                    "                            };",
                    "                            me.createShortcut(scWin, scInfo);",
                    "                        }",
                    "                        /* when click delete from shortcut */",
                    "                        if(action == 'del'){",
                    "                            record.set('isShortcut', false);",
                    "                            if(shortcutCon.down('#shortcut_' + record.get('id')) !== null){",
                    "                                shortcutCon.down('#shortcut_' + record.get('id')).destroy();",
                    "                            }",
                    "                        }",
                    "                    }",
                    "                }",
                    "            ],",
                    "            tools: [",
                    "                {",
                    "                    xtype: 'tool',",
                    "                    itemId: 'refresh',",
                    "                    tooltipType: 'title',",
                    "                    type: 'refresh',",
                    "                    bind: {",
                    "                        tooltip: '{refresh}'",
                    "                    },",
                    "                    listeners: {",
                    "                        click: function(){",
                    "                            Ext.getStore(Ext.getStore('CategoryStore').load());",
                    "                        }",
                    "                    }",
                    "                }",
                    "            ]",
                    "",
                    "        },",
                    "        {",
                    "            xtype:'container',",
                    "            layout:{",
                    "                type:'vbox',",
                    "            },",
                    "            flex:1,",
                    "            height:'100%',",
                    "            itemId:'eastCon',",
                    "            padding:'0 0 0 15',",
                    "            items:[",
                    "                {//아이콘 리스트 콘테이너",
                    "                    xtype:'container',",
                    "                    itemId:'selectedCon',",
                    "                    width:'100%',",
                    "                    flex:1,",
                    "                    scrollable:true,",
                    "                    layout:{",
                    "                        type:'column'",
                    "                    }",
                    "                },",
                    "                {//완료 버튼",
                    "                    xtype:'container',",
                    "                    height:35,",
                    "                    width:'100%',",
                    "                    itemId:'btnEditComplete',",
                    "                    items:[",
                    "                        {",
                    "                            xtype:'button',",
                    "                            minWidth:100,",
                    "                            text:locale.main.complete,",
                    "                            style:'float:right',",
                    "                            handler:function(button){",
                    "                                var listCon = button.up('#eastCon').down('#selectedCon');",
                    "                                var scs = listCon.items.items;",
                    "                                var value = [];",
                    "                                var loginWin = getController('Login').getLoginWin();",
                    "                                var scBox = loginWin.down('#shortcutsBox');",
                    "                                /* add new shortcut to shortcut list in login window */",
                    "                                Ext.Array.each(scs, function(entry, index){",
                    "                                    //                                     value.push('{ca_name:\"'+ entry.categoryName+'\",'+'ca_id:\"'+entry.categoryId+'\",src:\"'+entry.src+'\"}');",
                    "                                    var params = '{ca_name:\"'+entry.categoryName+'\",ca_id:\"'+entry.categoryId+'\",src:\"'+entry.src+'\",displayType:\"'+entry.displayType+'\"}';",
                    "                                    value.push(params);",
                    "                                });",
                    "                                /* update shortcuts set to userInfo to upload */",
                    "                                userInfo.nv_10 = value.toString();",
                    "                                /* save shortcut setting to server */",
                    "                                Ext.data.JsonP.request({",
                    "                                    params:userInfo,",
                    "                                    url:getMemberUpdateApi(),",
                    "                                    success:function(response){",
                    "                                        Ext.toast(locale.upload.posted);",
                    "                                        window.location.href = document.location.href;",
                    "                                        scWin.close();",
                    "                                    }",
                    "                                });",
                    "                            }",
                    "                        }",
                    "                    ]",
                    "                }",
                    "            ]",
                    "        }",
                    "    ]",
                    "});",
                    "scWin.show();"
                ]
            },
            "name": "setShortcuts",
            "designerId": "4b1ceab7-48af-4bff-987d-b1d89a62dd29"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "scWin",
                    "scInfo"
                ],
                "fn": "createShortcut",
                "implHandler": [
                    "var me = this;",
                    "var shortcutCon = scWin.down('#selectedCon');",
                    "/* destroy help message */",
                    "if(scWin.down('#notice') !== undefined && scWin.down('#notice') !== null){",
                    "    scWin.down('#notice').destroy();",
                    "}",
                    "",
                    "var store = Ext.getStore('CategoryStore');",
                    "var record = store.findRecord('id', scInfo.ca_id);",
                    "if(record !== null){",
                    "    record.set('isShortcut', true);",
                    "}",
                    "",
                    "/* add selected shortcut to selectedCon */",
                    "var scId = 'shortcut_' + scInfo.ca_id;",
                    "if(shortcutCon.down('#' + scId) === null){",
                    "    var shortcut = Ext.create(appName + '.view.Shortcut', {",
                    "        itemId:scId,",
                    "        margin:'0 9 9 0',",
                    "        listeners:{",
                    "/* event for edit shortcut */",
                    "/* target : shortcut image */",
                    "            editShortcut:function(target){",
                    "                me.getShortcutIcons(target);",
                    "            },",
                    "/* event for edit shortcut title */",
                    "            editTitle:function(target){",
                    "                me.editShortcutTitle(target);",
                    "            },",
                    "            deleteShortcut:function(target){",
                    "                target.destroy();",
                    "                store.load();",
                    "            }",
                    "        }",
                    "    });",
                    "    shortcut.getViewModel().setData(",
                    "        {",
                    "            ca_id:scInfo.ca_id,",
                    "            ca_name:scInfo.ca_name,",
                    "            piSrc:scInfo.piSrc,",
                    "            displayType:scInfo.displayType",
                    "        }",
                    "    );",
                    "    shortcut.down('#shortcutImage').setStyle('cursor', 'auto');",
                    "    shortcut.showEditButton();",
                    "    shortcutCon.add(shortcut);",
                    "}"
                ]
            },
            "name": "createShortcut",
            "designerId": "083b0878-408d-4398-ae2f-15a7c66a0f2a"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|commentHeader": [
                    "When eidt shortcut, list up preset of shortcut and select new icon to change image of shortcut"
                ],
                "designer|params": [
                    "target"
                ],
                "fn": "getShortcutIcons",
                "implHandler": [
                    "/* target = image in the shortcut */",
                    "var store = Ext.getStore('ShortcutsStore');",
                    "var scEditWin = Ext.create(appName + '.view.ShortcutEditWindow', {",
                    "    itemId:'scEditWin',",
                    "    width:810,",
                    "    height:650",
                    "}).show();",
                    "",
                    "var myMask = new Ext.LoadMask({",
                    "    msg    : 'Please wait...',",
                    "    target : scEditWin.down('#shortcutCon')",
                    "});",
                    "",
                    "myMask.show();",
                    "",
                    "store.on('load', function onLoadStore(sStore){",
                    "    sStore.un('load', onLoadStore);",
                    "    sStore.each(function(record){",
                    "        myMask.hide();",
                    "/* preset shortcut icons that provided by json */",
                    "        var sc = Ext.create(appName + '.view.Shortcut', {",
                    "            margin:'0 0 5 5',",
                    "            listeners:{",
                    "                click:function(categoryId, categoryName, displayType, image){",
                    "/* change shortcut icon */",
                    "                    target.getViewModel().set('piSrc', image.src);",
                    "                    scEditWin.close();",
                    "                }",
                    "            }",
                    "        });",
                    "        sc.changeSize(100);",
                    "        var dt = {piSrc:record.get('piSrc')};",
                    "        sc.getViewModel().setData(dt);",
                    "        scEditWin.down('#shortcutCon').add(sc);",
                    "    });",
                    "});",
                    "store.load();"
                ]
            },
            "name": "getShortcutIcons",
            "designerId": "f6f4a394-0a93-4b92-bced-9c1d7ae4d5c7"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "target"
                ],
                "fn": "editShortcutTitle",
                "implHandler": [
                    "var sc = target.up('shortcut');",
                    "var tf = sc.down('#titleField');",
                    "if(tf === undefined || tf === null){",
                    "    tf = Ext.create('Ext.form.field.Text', {",
                    "        width:'100%',",
                    "        height:25,",
                    "        itemId:'titleField',",
                    "        enableKeyEvents:true,",
                    "        listeners:[",
                    "            {",
                    "                keypress:function(textfield, event){",
                    "                    /* when press enter key */",
                    "                    if(event.getKey() == 13){",
                    "                        var val = textfield.getValue();",
                    "                        sc.getViewModel().set('ca_name', val);",
                    "                        textfield.destroy();",
                    "                    }",
                    "                }",
                    "            },",
                    "            {",
                    "                /* when textfield lost focus */",
                    "                blur:function(textfield, event, eOpts){",
                    "                    textfield.hide();",
                    "                }",
                    "            }",
                    "        ]",
                    "    });",
                    "    sc.add(tf);",
                    "}",
                    "else{",
                    "    tf.setValue('');",
                    "    tf.show();",
                    "}",
                    "tf.focus();"
                ]
            },
            "name": "editShortcutTitle",
            "designerId": "6ad01ef7-484e-45cc-9715-0c376b6c67e9"
        }
    ]
}